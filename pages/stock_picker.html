<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<title>Stock Prediction Interface</title>
	</head>
	<body>
		<h1>Stock Prediction and Report Generation</h1>
		<form id="predictForm">
			<label for="symbol">Select Stock Symbol:</label>
			<select id="symbol" name="symbol"></select>
			<button type="button" onclick="fetchPrediction()">
				Predict and Generate Report
			</button>
		</form>

		<div id="output">
			<h3>Results:</h3>
			<div id="predictionResults"></div>
			<a id="reportLink" href="#" target="_blank" style="display: none"
				>Download Report as PDF</a
			>
		</div>

		<script>
			document.addEventListener("DOMContentLoaded", function () {
				fetch("/available-symbols/")
					.then((response) => response.json())
					.then((data) => {
						const symbolSelect = document.getElementById("symbol");
						data.symbols.forEach((symbol) => {
							const option = document.createElement("option");
							option.value = symbol;
							option.textContent = symbol;
							symbolSelect.appendChild(option);
						});
					})
					.catch((error) =>
						console.error("Error fetching available symbols:", error)
					);
			});

			function fetchPrediction() {
				const symbol = document.getElementById("symbol").value;
				fetch("/predict/", {
					method: "POST",
					headers: {
						"Content-Type": "application/json",
					},
					body: JSON.stringify({ symbol: symbol }),
				})
					.then((response) => response.json())
					.then((data) => {
						if (data.error) {
							document.getElementById(
								"predictionResults"
							).innerHTML = `<p style="color: red;">Error: ${data.error}</p>`;
						} else {
							document.getElementById("predictionResults").innerHTML = `
                        <p>Historical and predicted data for <strong>${symbol}</strong> fetched successfully.</p>
                    `;
							document.getElementById(
								"reportLink"
							).href = `/generate-report/?symbol=${symbol}`;
							document.getElementById("reportLink").style.display = "block";
						}
					})
					.catch((error) => {
						console.error("Error fetching prediction:", error);
						document.getElementById(
							"predictionResults"
						).innerHTML = `<p style="color: red;">Error fetching prediction. Please try again later.</p>`;
					});
			}
		</script>
	</body>
</html>
