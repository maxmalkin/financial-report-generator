<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Stock Picker</title>
		<link rel="stylesheet" href="/static/styles.css" />
	</head>
	<body>
		<h1>Pick a Stock to Predict</h1>
		<form id="stockForm">
			<select id="stock-symbol">
				{% for symbol in symbols %}
				<option value="{{ symbol }}">{{ symbol }}</option>
				{% endfor %}
			</select>
			<button type="button" id="predict-button">Predict Stock</button>
		</form>
		<script>
			function getCookie(name) {
				let cookieValue = null;
				if (document.cookie && document.cookie !== "") {
					const cookies = document.cookie.split(";");
					for (let i = 0; i < cookies.length; i++) {
						const cookie = cookies[i].trim();
						if (cookie.substring(0, name.length + 1) === name + "=") {
							cookieValue = decodeURIComponent(
								cookie.substring(name.length + 1)
							);
							break;
						}
					}
				}
				return cookieValue;
			}

			const csrftoken = getCookie("csrftoken");

			document
				.getElementById("predict-button")
				.addEventListener("click", function () {
					const symbol = document.getElementById("stock-symbol").value;

					fetch("/api/predict/", {
						method: "POST",
						headers: {
							"Content-Type": "application/json",
							"X-CSRFToken": getCookie("csrftoken"),
						},
						body: JSON.stringify({ symbol: symbol }),
					})
						.then((response) => {
							if (!response.ok) {
								throw new Error("Network response was not ok");
							}
							return response.json();
						})
						.then((data) => {
							console.log("Prediction data:", data);
							window.location.href = `/api/generate-report/?symbol=${symbol}`;
						})
						.catch((error) => {
							console.error("Error predicting stock:", error);
						});
				});
		</script>
	</body>
</html>
